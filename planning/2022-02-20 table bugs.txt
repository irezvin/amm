2022-02-20



-   Пытаемся клонировать заголовок таблицы

    Убрать затык с тем, чтобы два view в createDefaultViews, потому 
    что мы не можем вместо data-amm-id передать view-у ссылку на текущий элемент
    (который создает defaultViews)

    Сейчас в таблице:

            var res = Amm.dom(
                {   
                    $: 'table',
                    data_amm_v: views
                }
            );


    когда делаем

            var res = Amm.dom([
                $: 'div',
                $$: [
                    {   
                        $: 'table',
                        data_amm_v: views
                    },
                    {   
                        $: 'table',
                        data_amm_v: views
                    },
                ]
            ]);
        
    вот так не катит. Пишет returns 5 top-level elements.
    А когда ставлю data-amm-id, то ошибки нет. Но таблица не появляется.
    Дать возможность "сообщить" views, что речь идет об этом элементе (раз),
    и дать возможность, может быть, связать views друг с другом, чтобы "сообщить",
    что они семантически относятся к одному и тому же элементу, но id ему при этом
    не назначать! 

-   ** Пересмотреть builder, сделать его удобным **
    Как минимум, задокументировать все аспекты, которые есть сейчас, 
    и как builder работает, потому что иначе я обречен каждый раз это вспоминать 
    и разбираться заново.
    
        id='__parent' - специальное значение id
    
-   Сделать, чтобы display parent view или collection view мог решать,
    какие элементы выводить, а какие нет, например, при помощи event-а?
    или callback'а? потому что нам для header cloning нужно четко дублировать 
    только head section!
    
    (а может запихнуть тупо её отдельный view и всё)
    
-   2) отчет об ошибках, control с ошибками
    -- Trait сообщает, что его элемент вывел ошибку, и регистрируется

2022-02-21

>   Когда у DisplayParent есть два view:
    
    +   view работает так: находит у элемента node;
        если не нашел, создает;
        убирает его из прежнего dom-узла и засовывает в свой!
    +   нужно или заново создавать себе,
    -   или клонировать тот, что нашел, вместе с его view!
        
-   Замечания по итогам "двух view" у таблицы
    
    -   сделать абсолютно универсальную поддержку множества view у любых 
        элементов может быть сложно, так как есть нюансы. 
        
        Например:
        -   общие ресурсы, которые могут быть только у одного view 
            (фокус - первое, что приходит в голову; scrollIntoView;
            чьи берем координаты?)
            -   предлагаемое решение: views-aware element (VAE)
                -   focusedView (как уже было сделано для input'ов); 
                -   primaryDimensionsView, primaryPositionView;
                -   syncPositionBetweenViews, syncDimensionsBetweenViews 
                -   и т.п.
        -   у displayParent'а два view. Мы засовываем элемент, у которого есть
            один view, в этот displayParent. Один html-узел можно показать, 
            а как быть со вторым?
                -   клонировать view и узел, но чтобы это работало,
                    любые view должны надежно клонироваться
                    
    >   фокус.
    
        Активация ячейки меняет фокус. 
        
        Навигация по таблице меняет активную ячейку, которая меняет фокус.
        При этом всегда будет фокусироваться элемент внутри первого view, 
        т.к. он первый реагирует на событие. А на практике должен реагировать 
        тот, на который кликнули
        
        -   есть два варианта, оба предполагают view-aware-view (VAV):
        
            X   а)  VAE: у таблицы есть activeTableView; 
                    клики и фокусировка на элементах устанавливают это свойство; 
                
            +   б)  мы можем устанавливать focus у view, который относится 
                    к view таблицы, у которого уже есть focus сейчас (то есть 
                    надо искать view таблицы с фокусом, и если такой есть, 
                    и в нем есть другой view нашего элемента, не ставить 
                    focus себе!!)
                +   похоже на а), только у нас activeTableView каждый раз
                    определяется динамически;
                ?   плюс можно, если document.activeElement нет, смотреть
                    window.event.target (а такой заполняется)?
                    
    -   editor
        
        Логично, чтобы он появлялся там же, где и фокус, а не в первой ячейке,
        но для этого нужно правильно назначать parent'а (а также скрывать 
        cell content в view, а не в cell!)
        
    >   Amm.View.Collection.shouldShowItemCallback: function(item)
        
>   Amm.View.Html.Collection / DisplayParent: 
 
    сейчас расчитано из четкого соответствия, что каждому item'у соответствует одна
    node, и их индексы совпадают. Это делает частичный вывод невозможным,
    и item'ы с несколькими нодами невозможными.
    
    _shownItems: [ [item[, node[, node...]]] ]
    
    findShownItem: function(itemOrNode) - returns index of _shownItems
    
    